<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vuetify Form Submit Page</title>
    <!-- 引入Vuetify的CSS和JavaScript文件 -->
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.6.3/dist/vuetify.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.6.3/dist/vuetify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    <div id="app">
        <v-app>

            <v-container>
                <template>
                    <v-tabs v-model="tab" grow>
                        <v-tab>创建订单</v-tab>
                        <v-tab>查询订单</v-tab>
                        <v-tab>联系我们</v-tab>
                    </v-tabs>

                    <v-tabs-items v-model="tab">
                        <v-tab-item>
                            <v-card class="deep-blue">
                                <v-card-title>
                                    <h2>下单模式</h2>
                                </v-card-title>
                                <v-text-field v-model="order.account" label="学习通账号" required></v-text-field>

                                <v-text-field v-model="order.password" label="学习通密码" :type="'password'"
                                    required></v-text-field>

                                <v-text-field v-model="order.contact" label="联系方式(查询订单使用)" required></v-text-field>

                                <v-textarea v-model="order.remark" label="备注(要刷的课程)"></v-textarea>

                                <v-btn block color="primary" @click='submitOrder()'>提交</v-btn>
                            </v-card>
                        </v-tab-item>

                        <v-tab-item>
                            <v-card class="deep-blue">
                                <v-card-title>
                                    <h2>查单模式</h2>
                                </v-card-title>
                                <v-text-field v-model="searchContact" label="输入联系方式查询订单"></v-text-field>
                                <v-btn block color="primary" @click="searchOrder">查询</v-btn>

                                <v-card-text>
                                    <h3>订单信息：</h3>
                                    <!-- 显示订单信息 -->
                                    <v-data-table :headers="tableHeaders" :items="orders" :items-per-page="10">
                                        <template v-slot:item.order_status="{ item }">
                                            <v-chip :color="getColor(item.order_status)" dark>
                                                {{ statusInfo[item.order_status] }}
                                            </v-chip>
                                        </template>
                                        <template v-slot:item.action="{ item }">

                                            <v-btn block color="primary" rounded outlined>
                                                Edit
                                            </v-btn>

                                        </template>
                                    </v-data-table>
                                </v-card-text>
                            </v-card>
                        </v-tab-item>

                        <v-tab-item>

                        </v-tab-item>

                    </v-tabs-items>
                </template>
                <template>
                    <div class="text-center">
                        <v-dialog v-model="paymentCodeVisible" width="500">
                            <template v-slot:activator="{ on, attrs }">
                            </template>
                            <v-card>
                                <v-card-title class="text-h5 grey lighten-2">
                                    weiXin Pay
                                </v-card-title>

                                <v-divider></v-divider>
                                <v-img
                                    src="https://lqy-other.oss-cn-beijing.aliyuncs.com/7cebf80fb81cee3eeb52f5b728eb41e.jpg"></v-img>

                                <v-card-actions>
                                    <v-spacer></v-spacer>
                                    <v-btn block color="primary" text @click="paymentCodeVisible = !paymentCodeVisible">
                                        close
                                    </v-btn>
                                </v-card-actions>
                            </v-card>
                        </v-dialog>
                    </div>
                </template>

                <template>
                    <div class="text-center">
                        <v-dialog v-model="attentionVar" width="500">
                            <template v-slot:activator="{ on, attrs }">
                            </template>
                            <v-card>
                                <v-toolbar color="primary" dark>下单注意</v-toolbar>
                                <v-card-text class="text-h6 pa-12">
                                    每门课2元 , 自行扫码支付 , 管理员会自行审核，
                                    未付款的订单将不会被处理
                                </v-card-text>
                                <v-divider></v-divider>
                                <v-card-actions>
                                    <v-spacer></v-spacer>
                                    <v-btn block color="primary" text
                                        @click="attentionVar = !attentionVar ; paymentCodeVisible = !paymentCodeVisible">
                                        to pay
                                    </v-btn>
                                </v-card-actions>
                            </v-card>
                        </v-dialog>
                    </div>
                </template>

                <template>
                    <div class="text-center">
                        <v-dialog v-model="errorTipVar" width="500">
                            <template v-slot:activator="{ on, attrs }">
                            </template>
                            <v-card>
                                <v-toolbar color="error" dark>出错了</v-toolbar>
                                <v-card-text class="text-h6 pa-12">
                                    {{errorTip}}
                                </v-card-text>
                                <v-divider></v-divider>
                                <v-card-actions>
                                    <v-spacer></v-spacer>
                                    <v-btn block color="primary" text
                                        @click="errorTipVar = !errorTipVar; errorTip = ''">
                                        I know
                                    </v-btn>
                                </v-card-actions>
                            </v-card>
                        </v-dialog>
                    </div>
                </template>
            </v-container>
        </v-app>
    </div>

    <script>
        new Vue({
            el: '#app',
            vuetify: new Vuetify(),
            data() {
                return {
                    order: {
                        account: '',
                        password: '',
                        contact: '',
                        remark: ''
                    },
                    tab: null,
                    orders: [],
                    errorTip: "",
                    errorTipVar: false,
                    searchContact: '',
                    attentionVar: false,
                    paymentCodeVisible: false,
                    tableHeaders: [
                        { text: '订单号', value: 'id' },
                        { text: '账户', value: 'account' },
                        { text: '订单状态', value: 'order_status' },
                        { text: '备注', value: 'note' },
                        { text: '下单时间', value: 'order_time' },
                        { text: '操作', value: 'action' }
                    ],
                    statusInfo: ["待处理", "未付款", "准备处理", "处理中", "订单完成"],
                    statusColor: ["#FFD710", "#F14C4C", "#569CD6", "#DCDCAA", "#529949"]
                };
            },
            methods: {
                getColor(status) {
                    return this.statusColor[status];
                },

                submitOrder() {
                    // 提交订单逻辑
                    if (this.order.account === '' || this.order.password === '') {
                        this.errorTip = "账号和密码不能为空 , 备注为空默认帮你刷第一门未刷完的课";
                        this.errorTipVar = true
                        return;
                    } else {
                        axios.post('/api/submit/order', this.order)
                            .then(response => {
                                this.attentionVar = true;
                            })
                            .catch(error => {
                                // 处理错误响应
                                this.errorTip = error.message;
                                this.errorTipVar = true;
                                return;
                            });

                    }
                },
                switchPayCode() {
                    this.paymentCodeVisible = !this.paymentCodeVisible;
                },
                searchOrder() {
                    // 查询订单逻辑
                    axios.get('/api/query/order', {
                        params: {
                            contact: this.searchContact
                        }
                    })
                        .then(response => {
                            // 处理成功响应，更新订单信息列表
                            this.orders = response.data.data;
                            console.log(this.order);
                        })
                        .catch(error => {
                            // 处理错误响应
                            console.error('查询订单失败：', error);
                        });
                }
            }
        });
    </script>


</body>

</html>